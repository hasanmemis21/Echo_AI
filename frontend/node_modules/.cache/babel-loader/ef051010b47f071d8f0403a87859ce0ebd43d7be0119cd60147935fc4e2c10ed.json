{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Hasan Memi\\u015F\\\\Desktop\\\\DuyguAI_Yeni\\\\frontend\\\\src\\\\EmotionInput.js\",\n  _s = $RefreshSig$();\n// src/EmotionInput.js\n\nimport React, { useRef, useState, useEffect } from 'react';\nimport { BACKEND_URL } from './config';\nimport './styles/EmotionInput.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function EmotionInput({\n  result,\n  setResult\n}) {\n  _s();\n  var _result$recommended_m;\n  const videoRef = useRef(null);\n  const [text, setText] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [recording, setRecording] = useState(false);\n  const [stream, setStream] = useState(null);\n\n  // Video <--> stream binding\n  useEffect(() => {\n    if (stream && videoRef.current) {\n      videoRef.current.srcObject = stream;\n    }\n  }, [stream]);\n\n  // KamerayÄ± durdur\n  const stopStream = () => {\n    if (stream) {\n      stream.getTracks().forEach(t => t.stop());\n      setStream(null);\n    }\n  };\n\n  // Unmount ta da kapat\n  useEffect(() => {\n    return () => stopStream();\n  }, []);\n\n  // Ses kaydÄ± (sadece bayrak)\n  const startRecording = () => {\n    setRecording(true);\n    setTimeout(() => setRecording(false), 5000);\n  };\n\n  // Kamera aÃ§\n  const startCamera = async () => {\n    stopStream();\n    try {\n      const s = await navigator.mediaDevices.getUserMedia({\n        video: true\n      });\n      setStream(s);\n    } catch (err) {\n      console.error('Kamera hatasÄ±:', err);\n      alert('Kameraya eriÅŸilemedi: ' + err.message);\n    }\n  };\n\n  // FotoÄŸraf Ã§ek ve hemen analiz et\n  const captureFaceAndAnalyze = async () => {\n    if (!stream || !videoRef.current) return;\n\n    // 1) Kare yakala\n    const video = videoRef.current;\n    const canvas = document.createElement('canvas');\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);\n    const b64 = canvas.toDataURL('image/jpeg').split(',')[1];\n\n    // 2) Kamera kapat\n    stopStream();\n\n    // 3) Analiz isteÄŸini at\n    setLoading(true);\n    try {\n      console.log('ðŸ”” GÃ¶nderilen payload:', {\n        text,\n        face: b64,\n        use_audio: recording\n      });\n      const res = await fetch(`${BACKEND_URL}/api/analyze`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          text: text || null,\n          face: b64,\n          use_audio: recording\n        })\n      });\n      const data = await res.json();\n      console.log('ðŸ”” Gelen yanÄ±t:', data);\n      setResult(data);\n    } catch (err) {\n      console.error('Analiz hatasÄ±:', err);\n      alert('Sunucuya baÄŸlanÄ±lamadÄ±.');\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"emotion-input-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n      placeholder: \"Metni buraya gir...\",\n      value: text,\n      onChange: e => setText(e.target.value),\n      style: {\n        width: '100%',\n        maxWidth: 400,\n        marginBottom: '1rem'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }, this), !stream && /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: startCamera,\n      children: \"Kameray\\u0131 A\\xE7\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 9\n    }, this), stream && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        margin: '1rem 0'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        ref: videoRef,\n        autoPlay: true,\n        style: {\n          width: 300\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: captureFaceAndAnalyze,\n        disabled: loading,\n        style: {\n          display: 'block',\n          marginTop: '0.5rem'\n        },\n        children: loading ? 'Analiz Ediliyorâ€¦' : 'FotoÄŸraf Ã‡ek ve Analiz Et'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: startRecording,\n      disabled: recording,\n      style: {\n        display: 'block',\n        marginBottom: '1rem'\n      },\n      children: recording ? 'Ses Kaydediliyorâ€¦' : 'Ses KaydÄ± (5s)'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }, this), (result === null || result === void 0 ? void 0 : (_result$recommended_m = result.recommended_music) === null || _result$recommended_m === void 0 ? void 0 : _result$recommended_m.length) > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-grid\",\n      children: result.recommended_music.map(id => /*#__PURE__*/_jsxDEV(\"iframe\", {\n        src: `https://www.youtube.com/embed/${id}?autoplay=1`,\n        allow: \"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\",\n        allowFullScreen: true,\n        title: id\n      }, id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 5\n  }, this);\n}\n_s(EmotionInput, \"XJR610NFBjfCWnOK5T+pn6cZUcc=\");\n_c = EmotionInput;\nvar _c;\n$RefreshReg$(_c, \"EmotionInput\");","map":{"version":3,"names":["React","useRef","useState","useEffect","BACKEND_URL","jsxDEV","_jsxDEV","EmotionInput","result","setResult","_s","_result$recommended_m","videoRef","text","setText","loading","setLoading","recording","setRecording","stream","setStream","current","srcObject","stopStream","getTracks","forEach","t","stop","startRecording","setTimeout","startCamera","s","navigator","mediaDevices","getUserMedia","video","err","console","error","alert","message","captureFaceAndAnalyze","canvas","document","createElement","width","videoWidth","height","videoHeight","getContext","drawImage","b64","toDataURL","split","log","face","use_audio","res","fetch","method","headers","body","JSON","stringify","data","json","className","children","placeholder","value","onChange","e","target","style","maxWidth","marginBottom","fileName","_jsxFileName","lineNumber","columnNumber","onClick","margin","ref","autoPlay","disabled","display","marginTop","recommended_music","length","map","id","src","allow","allowFullScreen","title","_c","$RefreshReg$"],"sources":["C:/Users/Hasan MemiÅŸ/Desktop/DuyguAI_Yeni/frontend/src/EmotionInput.js"],"sourcesContent":["// src/EmotionInput.js\r\n\r\nimport React, { useRef, useState, useEffect } from 'react';\r\nimport { BACKEND_URL } from './config';\r\nimport './styles/EmotionInput.css';\r\n\r\nexport default function EmotionInput({ result, setResult }) {\r\n  const videoRef = useRef(null);\r\n  const [text, setText] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [recording, setRecording] = useState(false);\r\n  const [stream, setStream] = useState(null);\r\n\r\n  // Video <--> stream binding\r\n  useEffect(() => {\r\n    if (stream && videoRef.current) {\r\n      videoRef.current.srcObject = stream;\r\n    }\r\n  }, [stream]);\r\n\r\n  // KamerayÄ± durdur\r\n  const stopStream = () => {\r\n    if (stream) {\r\n      stream.getTracks().forEach(t => t.stop());\r\n      setStream(null);\r\n    }\r\n  };\r\n\r\n  // Unmount ta da kapat\r\n  useEffect(() => {\r\n    return () => stopStream();\r\n  }, []);\r\n\r\n  // Ses kaydÄ± (sadece bayrak)\r\n  const startRecording = () => {\r\n    setRecording(true);\r\n    setTimeout(() => setRecording(false), 5000);\r\n  };\r\n\r\n  // Kamera aÃ§\r\n  const startCamera = async () => {\r\n    stopStream();\r\n    try {\r\n      const s = await navigator.mediaDevices.getUserMedia({ video: true });\r\n      setStream(s);\r\n    } catch (err) {\r\n      console.error('Kamera hatasÄ±:', err);\r\n      alert('Kameraya eriÅŸilemedi: ' + err.message);\r\n    }\r\n  };\r\n\r\n  // FotoÄŸraf Ã§ek ve hemen analiz et\r\n  const captureFaceAndAnalyze = async () => {\r\n    if (!stream || !videoRef.current) return;\r\n\r\n    // 1) Kare yakala\r\n    const video = videoRef.current;\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = video.videoWidth;\r\n    canvas.height = video.videoHeight;\r\n    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);\r\n    const b64 = canvas.toDataURL('image/jpeg').split(',')[1];\r\n\r\n    // 2) Kamera kapat\r\n    stopStream();\r\n\r\n    // 3) Analiz isteÄŸini at\r\n    setLoading(true);\r\n    try {\r\n      console.log('ðŸ”” GÃ¶nderilen payload:', { text, face: b64, use_audio: recording });\r\n      const res = await fetch(`${BACKEND_URL}/api/analyze`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ text: text || null, face: b64, use_audio: recording })\r\n      });\r\n      const data = await res.json();\r\n      console.log('ðŸ”” Gelen yanÄ±t:', data);\r\n      setResult(data);\r\n    } catch (err) {\r\n      console.error('Analiz hatasÄ±:', err);\r\n      alert('Sunucuya baÄŸlanÄ±lamadÄ±.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"emotion-input-container\">\r\n      {/* Metin */}\r\n      <textarea\r\n        placeholder=\"Metni buraya gir...\"\r\n        value={text}\r\n        onChange={e => setText(e.target.value)}\r\n        style={{ width: '100%', maxWidth: 400, marginBottom: '1rem' }}\r\n      />\r\n\r\n      {/* Kamera */}\r\n      {!stream && (\r\n        <button onClick={startCamera}>KamerayÄ± AÃ§</button>\r\n      )}\r\n      {stream && (\r\n        <div style={{ margin: '1rem 0' }}>\r\n          <video ref={videoRef} autoPlay style={{ width: 300 }} />\r\n          <button\r\n            onClick={captureFaceAndAnalyze}\r\n            disabled={loading}\r\n            style={{ display: 'block', marginTop: '0.5rem' }}\r\n          >\r\n            {loading ? 'Analiz Ediliyorâ€¦' : 'FotoÄŸraf Ã‡ek ve Analiz Et'}\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Ses */}\r\n      <button\r\n        onClick={startRecording}\r\n        disabled={recording}\r\n        style={{ display: 'block', marginBottom: '1rem' }}\r\n      >\r\n        {recording ? 'Ses Kaydediliyorâ€¦' : 'Ses KaydÄ± (5s)'}\r\n      </button>\r\n\r\n      {/* YouTube Ã¶nerileri */}\r\n      {result?.recommended_music?.length > 0 && (\r\n        <div className=\"video-grid\">\r\n          {result.recommended_music.map(id => (\r\n            <iframe\r\n              key={id}\r\n              src={`https://www.youtube.com/embed/${id}?autoplay=1`}\r\n              allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\r\n              allowFullScreen\r\n              title={id}\r\n            />\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}