{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import{BACKEND_URL}from'../config';import'../styles/EmotionInput.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function EmotionInput(_ref){let{onResults}=_ref;const[text,setText]=useState('');const[stream,setStream]=useState(null);const[imageData,setImageData]=useState(null);const[recording,setRecording]=useState(false);const mediaRecorderRef=useRef(null);const chunksRef=useRef([]);const[audioUrl,setAudioUrl]=useState('');const[audioBase64,setAudioBase64]=useState('');const[loading,setLoading]=useState(false);const videoRef=useRef(null);const canvasRef=useRef(null);// Kamera aç\nconst openCamera=async()=>{const s=await navigator.mediaDevices.getUserMedia({video:true});setStream(s);videoRef.current.srcObject=s;await videoRef.current.play();setImageData(null);};// Fotoğrafı yakala\nconst capturePhoto=()=>{if(!stream)return;const video=videoRef.current;canvasRef.current.width=video.videoWidth;canvasRef.current.height=video.videoHeight;const ctx=canvasRef.current.getContext('2d');ctx.drawImage(video,0,0);const b64=canvasRef.current.toDataURL('image/png').split(',')[1];setImageData(b64);// istersen kamerayı kapat:\nstream.getTracks().forEach(t=>t.stop());setStream(null);};// Ses kaydı başlat\nconst startRecording=async()=>{const s=await navigator.mediaDevices.getUserMedia({audio:true});chunksRef.current=[];const recorder=new MediaRecorder(s);recorder.ondataavailable=e=>e.data.size&&chunksRef.current.push(e.data);recorder.onstop=()=>{s.getTracks().forEach(t=>t.stop());const blob=new Blob(chunksRef.current,{type:'audio/webm'});const url=URL.createObjectURL(blob);setAudioUrl(url);const r=new FileReader();r.onloadend=()=>setAudioBase64(r.result.split(',')[1]);r.readAsDataURL(blob);setRecording(false);};recorder.start();mediaRecorderRef.current=recorder;setRecording(true);setAudioUrl('');setAudioBase64('');};const stopRecording=()=>{if(mediaRecorderRef.current){mediaRecorderRef.current.stop();mediaRecorderRef.current=null;}};// Analiz isteği\nconst analyze=async()=>{if(recording){alert('Ses kaydını önce durdurun.');return;}if(!text&&!imageData&&!audioBase64){alert('En az birini girin: metin, fotoğraf veya ses.');return;}setLoading(true);try{const res=await fetch(`${BACKEND_URL}/api/analyze`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text:text||null,face:imageData||null,audio:audioBase64||null,use_audio:Boolean(audioBase64)})});const json=await res.json();onResults(json);// Temizle\nsetText('');setImageData(null);setAudioUrl('');setAudioBase64('');}catch(e){console.error(e);alert('Analiz sırasında hata oluştu.');}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"emotion-input\",children:[/*#__PURE__*/_jsx(\"textarea\",{className:\"emotion-input__text\",placeholder:\"Metni buraya girin\",value:text,onChange:e=>setText(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"emotion-input__controls\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"control-block\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:openCamera,disabled:loading,children:\"Kamera A\\xE7\"}),/*#__PURE__*/_jsx(\"button\",{onClick:capturePhoto,disabled:!stream||loading,children:\"Foto\\u011Fraf \\xC7ek\"}),/*#__PURE__*/_jsx(\"video\",{ref:videoRef,style:{width:160,marginTop:8}}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,style:{display:'none'}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"control-block\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:startRecording,disabled:recording||loading,children:recording?'Kaydediliyor…':'Ses Kaydı Başlat'}),/*#__PURE__*/_jsx(\"button\",{onClick:stopRecording,disabled:!recording||loading,children:\"Durdur\"}),audioUrl&&/*#__PURE__*/_jsx(\"audio\",{controls:true,src:audioUrl,style:{marginTop:8}})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"emotion-input__analyze\",onClick:analyze,disabled:loading,children:loading?'Analiz Ediliyor…':'Analiz Et'})]});}","map":{"version":3,"names":["React","useState","useRef","useEffect","BACKEND_URL","jsx","_jsx","jsxs","_jsxs","EmotionInput","_ref","onResults","text","setText","stream","setStream","imageData","setImageData","recording","setRecording","mediaRecorderRef","chunksRef","audioUrl","setAudioUrl","audioBase64","setAudioBase64","loading","setLoading","videoRef","canvasRef","openCamera","s","navigator","mediaDevices","getUserMedia","video","current","srcObject","play","capturePhoto","width","videoWidth","height","videoHeight","ctx","getContext","drawImage","b64","toDataURL","split","getTracks","forEach","t","stop","startRecording","audio","recorder","MediaRecorder","ondataavailable","e","data","size","push","onstop","blob","Blob","type","url","URL","createObjectURL","r","FileReader","onloadend","result","readAsDataURL","start","stopRecording","analyze","alert","res","fetch","method","headers","body","JSON","stringify","face","use_audio","Boolean","json","console","error","className","children","placeholder","value","onChange","target","onClick","disabled","ref","style","marginTop","display","controls","src"],"sources":["C:/Users/Hasan Memiş/Desktop/DuyguAI_Yeni/frontend/src/components/EmotionInput.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { BACKEND_URL } from '../config';\r\nimport '../styles/EmotionInput.css';\r\n\r\nexport default function EmotionInput({ onResults }) {\r\n  const [text, setText] = useState('');\r\n  const [stream, setStream] = useState(null);\r\n  const [imageData, setImageData] = useState(null);\r\n  const [recording, setRecording] = useState(false);\r\n  const mediaRecorderRef = useRef(null);\r\n  const chunksRef = useRef([]);\r\n  const [audioUrl, setAudioUrl] = useState('');\r\n  const [audioBase64, setAudioBase64] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n\r\n  // Kamera aç\r\n  const openCamera = async () => {\r\n    const s = await navigator.mediaDevices.getUserMedia({ video: true });\r\n    setStream(s);\r\n    videoRef.current.srcObject = s;\r\n    await videoRef.current.play();\r\n    setImageData(null);\r\n  };\r\n\r\n  // Fotoğrafı yakala\r\n  const capturePhoto = () => {\r\n    if (!stream) return;\r\n    const video = videoRef.current;\r\n    canvasRef.current.width = video.videoWidth;\r\n    canvasRef.current.height = video.videoHeight;\r\n    const ctx = canvasRef.current.getContext('2d');\r\n    ctx.drawImage(video, 0, 0);\r\n    const b64 = canvasRef.current.toDataURL('image/png').split(',')[1];\r\n    setImageData(b64);\r\n    // istersen kamerayı kapat:\r\n    stream.getTracks().forEach(t => t.stop());\r\n    setStream(null);\r\n  };\r\n\r\n  // Ses kaydı başlat\r\n  const startRecording = async () => {\r\n    const s = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n    chunksRef.current = [];\r\n    const recorder = new MediaRecorder(s);\r\n    recorder.ondataavailable = e => e.data.size && chunksRef.current.push(e.data);\r\n    recorder.onstop = () => {\r\n      s.getTracks().forEach(t => t.stop());\r\n      const blob = new Blob(chunksRef.current, { type: 'audio/webm' });\r\n      const url = URL.createObjectURL(blob);\r\n      setAudioUrl(url);\r\n      const r = new FileReader();\r\n      r.onloadend = () => setAudioBase64(r.result.split(',')[1]);\r\n      r.readAsDataURL(blob);\r\n      setRecording(false);\r\n    };\r\n    recorder.start();\r\n    mediaRecorderRef.current = recorder;\r\n    setRecording(true);\r\n    setAudioUrl('');\r\n    setAudioBase64('');\r\n  };\r\n\r\n  const stopRecording = () => {\r\n    if (mediaRecorderRef.current) {\r\n      mediaRecorderRef.current.stop();\r\n      mediaRecorderRef.current = null;\r\n    }\r\n  };\r\n\r\n  // Analiz isteği\r\n  const analyze = async () => {\r\n    if (recording) {\r\n      alert('Ses kaydını önce durdurun.');\r\n      return;\r\n    }\r\n    if (!text && !imageData && !audioBase64) {\r\n      alert('En az birini girin: metin, fotoğraf veya ses.');\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(`${BACKEND_URL}/api/analyze`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          text: text || null,\r\n          face: imageData || null,\r\n          audio: audioBase64 || null,\r\n          use_audio: Boolean(audioBase64)\r\n        })\r\n      });\r\n      const json = await res.json();\r\n      onResults(json);\r\n      // Temizle\r\n      setText('');\r\n      setImageData(null);\r\n      setAudioUrl('');\r\n      setAudioBase64('');\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert('Analiz sırasında hata oluştu.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"emotion-input\">\r\n      <textarea\r\n        className=\"emotion-input__text\"\r\n        placeholder=\"Metni buraya girin\"\r\n        value={text}\r\n        onChange={e => setText(e.target.value)}\r\n      />\r\n\r\n      <div className=\"emotion-input__controls\">\r\n        <div className=\"control-block\">\r\n          <button onClick={openCamera} disabled={loading}>\r\n            Kamera Aç\r\n          </button>\r\n          <button onClick={capturePhoto} disabled={!stream || loading}>\r\n            Fotoğraf Çek\r\n          </button>\r\n          <video ref={videoRef} style={{ width: 160, marginTop: 8 }} />\r\n          <canvas ref={canvasRef} style={{ display: 'none' }} />\r\n        </div>\r\n\r\n        <div className=\"control-block\">\r\n          <button onClick={startRecording} disabled={recording || loading}>\r\n            {recording ? 'Kaydediliyor…' : 'Ses Kaydı Başlat'}\r\n          </button>\r\n          <button onClick={stopRecording} disabled={!recording || loading}>\r\n            Durdur\r\n          </button>\r\n          {audioUrl && <audio controls src={audioUrl} style={{ marginTop: 8 }} />}\r\n        </div>\r\n      </div>\r\n\r\n      <button\r\n        className=\"emotion-input__analyze\"\r\n        onClick={analyze}\r\n        disabled={loading}\r\n      >\r\n        {loading ? 'Analiz Ediliyor…' : 'Analiz Et'}\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}